<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Web Proxy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Previous CSS styles remain the same -->
    <style>
        /* Previous styles remain unchanged */
    </style>
</head>
<body>
    <div id="particles-js"></div>
    
    <div class="container">
        <div class="proxy-interface">
            <div class="nav-bar">
                <button class="nav-button" onclick="proxyHistory.back()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="nav-button" onclick="proxyHistory.forward()">
                    <i class="fas fa-arrow-right"></i> Forward
                </button>
                <button class="nav-button" onclick="proxyHistory.refresh()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="nav-button" onclick="proxyHistory.home()">
                    <i class="fas fa-home"></i> Home
                </button>
            </div>
            <div class="url-bar">
                <input type="url" class="url-input" id="urlInput" 
                       placeholder="Enter URL (e.g., https://example.com)">
                <button class="load-button" onclick="loadUrl()">
                    <i class="fas fa-globe"></i> Load
                </button>
            </div>
            <div class="frame-container" id="frameContainer"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Particles.js configuration remains the same
        particlesJS("particles-js", {
            // Previous particles configuration
        });

        class ProxyHistory {
            constructor() {
                this.history = [];
                this.currentIndex = -1;
                this.frame = null;
                this.proxyBase = 'https://cors-anywhere.herokuapp.com/';
            }

            initialize() {
                this.frame = document.createElement('iframe');
                this.frame.className = 'proxy-frame';
                this.frame.sandbox = 'allow-same-origin allow-scripts allow-forms allow-popups';
                document.getElementById('frameContainer').appendChild(this.frame);
                
                // Handle iframe load events
                this.frame.addEventListener('load', () => {
                    try {
                        this.processIframeContent();
                    } catch (error) {
                        this.showStatus('Error processing page content', 'error');
                    }
                });
            }

            processIframeContent() {
                const frameDoc = this.frame.contentDocument || this.frame.contentWindow.document;
                
                // Rewrite all links to go through the proxy
                const links = frameDoc.getElementsByTagName('a');
                for (let link of links) {
                    const href = link.getAttribute('href');
                    if (href) {
                        if (href.startsWith('http')) {
                            link.href = this.proxyBase + href;
                        } else if (href.startsWith('/')) {
                            const baseUrl = this.getCurrentBaseUrl();
                            link.href = this.proxyBase + baseUrl + href;
                        }
                        
                        // Add click event handler
                        link.onclick = (e) => {
                            e.preventDefault();
                            this.navigate(link.href);
                        };
                    }
                }
            }

            getCurrentBaseUrl() {
                const currentUrl = this.history[this.currentIndex];
                if (!currentUrl) return '';
                const url = new URL(currentUrl.replace(this.proxyBase, ''));
                return url.origin;
            }

            async navigate(url) {
                if (!this.frame) this.initialize();
                
                try {
                    const cleanUrl = url.replace(this.proxyBase, '');
                    const proxyUrl = this.proxyBase + cleanUrl;
                    
                    this.history = this.history.slice(0, this.currentIndex + 1);
                    this.history.push(proxyUrl);
                    this.currentIndex++;
                    
                    this.frame.src = proxyUrl;
                    this.showStatus('Loading website...', 'success');
                    
                    // Update URL input
                    document.getElementById('urlInput').value = cleanUrl;
                } catch (error) {
                    this.showStatus('Error loading page: ' + error.message, 'error');
                }
            }

            // Previous methods (back, forward, refresh, home) remain the same
            
            showStatus(message, type) {
                const status = document.createElement('div');
                status.className = `status ${type}`;
                status.textContent = message;
                document.body.appendChild(status);
                setTimeout(() => status.remove(), 3000);
            }
        }

        const proxyHistory = new ProxyHistory();

        function loadUrl() {
            const url = document.getElementById('urlInput').value;
            if (url) {
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    proxyHistory.navigate('https://' + url);
                } else {
                    proxyHistory.navigate(url);
                }
            } else {
                proxyHistory.showStatus('Please enter a valid URL', 'error');
            }
        }

        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadUrl();
            }
        });
    </script>
</body>
</html>
